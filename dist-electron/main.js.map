{"version":3,"file":"main.js","sources":["../src/main/onion/install/downloader.ts","../src/main/onion/install/verify.ts","../src/main/onion/install/unpack.ts","../src/main/onion/pinnedHashes.ts","../src/main/onion/componentRegistry.ts","../src/main/onion/install/swapperRollback.ts","../src/main/onion/errors.ts","../src/main/onion/assetNaming.ts","../src/main/onion/install/installTor.ts","../src/main/onion/install/installLokinet.ts","../src/main/onion/runtime/torManager.ts","../src/main/onion/runtime/lokinetManager.ts","../src/main/onion/runtime/onionRuntime.ts","../src/main/onion/update/checkUpdates.ts","../src/main.ts"],"sourcesContent":["import fs from \"node:fs\";\nimport https from \"node:https\";\nimport type { IncomingMessage } from \"node:http\";\nimport { pipeline } from \"node:stream/promises\";\nimport { URL } from \"node:url\";\n\r\nexport type DownloadProgress = {\r\n  receivedBytes: number;\r\n  totalBytes: number;\r\n};\r\n\r\nconst getResponse = async (url: string, redirects = 0): Promise<IncomingMessage> => {\n  if (redirects > 5) {\n    throw new Error(\"Too many redirects\");\n  }\n  const response = await new Promise<IncomingMessage>((resolve, reject) => {\n    const req = https.get(\n      url,\n      { headers: { \"User-Agent\": \"nkc-onion-installer\" } },\n      (res) => resolve(res)\n    );\n    req.on(\"error\", reject);\n  });\n  if (response.statusCode && [301, 302, 307, 308].includes(response.statusCode)) {\n    const redirect = response.headers.location;\n    response.resume();\n    if (!redirect) {\n      throw new Error(\"Redirect missing location header\");\n    }\n    const nextUrl = new URL(redirect, url).toString();\n    return getResponse(nextUrl, redirects + 1);\n  }\n  if (response.statusCode && response.statusCode >= 400) {\n    const status = response.statusCode;\n    const statusMessage = response.statusMessage ?? \"\";\n    const error = new Error(`Download failed: ${status} ${statusMessage}`.trim());\n    (error as { details?: Record<string, unknown> }).details = {\n      url,\n      status,\n      statusMessage,\n    };\n    throw error;\n  }\n  return response;\n};\n\r\nexport const downloadFile = async (\r\n  url: string,\r\n  dest: string,\r\n  onProgress?: (progress: DownloadProgress) => void\r\n) => {\r\n  const request = await getResponse(url);\r\n\r\n  const totalBytes = Number(request.headers[\"content-length\"] ?? 0);\r\n  let receivedBytes = 0;\r\n  request.on(\"data\", (chunk: Buffer) => {\r\n    receivedBytes += chunk.length;\r\n    onProgress?.({ receivedBytes, totalBytes });\r\n  });\r\n\r\n  await pipeline(request, fs.createWriteStream(dest));\r\n};\r\n","import crypto from \"node:crypto\";\r\nimport fs from \"node:fs\";\r\n\r\nconst hashFile = async (filePath: string) => {\r\n  const hash = crypto.createHash(\"sha256\");\r\n  const stream = fs.createReadStream(filePath);\r\n  return new Promise<string>((resolve, reject) => {\r\n    stream.on(\"data\", (chunk) => hash.update(chunk));\r\n    stream.on(\"error\", reject);\r\n    stream.on(\"end\", () => resolve(hash.digest(\"hex\")));\r\n  });\r\n};\r\n\r\nexport const verifySha256 = async (filePath: string, expectedSha256: string) => {\r\n  const actual = await hashFile(filePath);\r\n  if (actual.toLowerCase() !== expectedSha256.toLowerCase()) {\r\n    const error = new Error(\r\n      `SHA256 mismatch (expected=${expectedSha256.toLowerCase()}, actual=${actual.toLowerCase()})`\r\n    );\r\n    (error as { expected?: string; actual?: string }).expected = expectedSha256;\r\n    (error as { expected?: string; actual?: string }).actual = actual;\r\n    throw error;\r\n  }\r\n};\r\n","import { execFile } from \"node:child_process\";\n\nexport const unpackArchive = async (archivePath: string, destDir: string) => {\n  const lowerPath = archivePath.toLowerCase();\n  const run = async (cmd: string, args: string[]) => {\n    return new Promise<void>((resolve, reject) => {\n      execFile(cmd, args, { windowsHide: true }, (error, stdout, stderr) => {\n        if (!error) {\n          resolve();\n          return;\n        }\n        const wrapped = new Error(\n          `${error.message}\\ncmd=${cmd} ${args.join(\" \")}\\n${stderr || stdout || \"\"}`.trim()\n        );\n        (wrapped as { details?: Record<string, unknown> }).details = {\n          cmd,\n          args,\n          stderr: stderr?.toString?.() ?? String(stderr ?? \"\"),\n          stdout: stdout?.toString?.() ?? String(stdout ?? \"\"),\n          code: (error as unknown as { code?: string }).code,\n        };\n        reject(wrapped);\n      });\n    });\n  };\n\n  if (lowerPath.endsWith(\".zip\")) {\n    if (process.platform === \"win32\") {\n      await run(\"powershell\", [\n        \"-NoProfile\",\n        \"-Command\",\n        `Expand-Archive -Force -Path '${archivePath}' -DestinationPath '${destDir}'`,\n      ]);\n      return;\n    }\n    await run(\"unzip\", [\"-o\", archivePath, \"-d\", destDir]);\n    return;\n  }\n  if (\n    lowerPath.endsWith(\".tar.gz\") ||\n    lowerPath.endsWith(\".tgz\") ||\n    lowerPath.endsWith(\".tar.xz\")\n  ) {\n    await run(process.platform === \"win32\" ? \"tar.exe\" : \"tar\", [\n      \"-xf\",\n      archivePath,\n      \"-C\",\n      destDir,\n    ]);\n    return;\n  }\n  throw new Error(\"Unsupported archive format\");\n};\n","export type PinnedKeyParts = {\r\n  platform: NodeJS.Platform;\r\n  arch: NodeJS.Architecture;\r\n  version: string;\r\n  filename: string;\r\n};\r\n\r\nexport const makePinnedKey = (parts: PinnedKeyParts) =>\r\n  `${parts.platform}:${parts.arch}:${parts.version}:${parts.filename}`;\r\n\r\nexport const pinnedSha256 = {\r\n  tor: {\r\n    [makePinnedKey({ platform: \"android\", arch: \"arm64\", version: \"15.0.4\", filename: \"tor-expert-bundle-android-aarch64-15.0.4.tar.gz\" })]: \"b1582efca86db843bb4fa435edd766086a77334b32924a72686894212d5e5955\",\r\n    [makePinnedKey({ platform: \"android\", arch: \"arm\", version: \"15.0.4\", filename: \"tor-expert-bundle-android-armv7-15.0.4.tar.gz\" })]: \"fdb2d8ed01e40506f1518ef3e5f83a3d62e6f5ac0f8798917532798d6c05771f\",\r\n    [makePinnedKey({ platform: \"android\", arch: \"ia32\", version: \"15.0.4\", filename: \"tor-expert-bundle-android-x86-15.0.4.tar.gz\" })]: \"c92f7ffbf105e0ae195e28ac516648b54ba1323f24b47ae236a6d711c7daffe2\",\r\n    [makePinnedKey({ platform: \"android\", arch: \"x64\", version: \"15.0.4\", filename: \"tor-expert-bundle-android-x86_64-15.0.4.tar.gz\" })]: \"0adf0201950c02d36897569576eff37718d4afe1835052a3bc424b78be1a0605\",\r\n    [makePinnedKey({ platform: \"linux\", arch: \"ia32\", version: \"15.0.4\", filename: \"tor-expert-bundle-linux-i686-15.0.4.tar.gz\" })]: \"228d1a1ccd2683b8c6abc4fd701ebdc7b59254bae47b6acd253cb6aea9338a50\",\r\n    [makePinnedKey({ platform: \"linux\", arch: \"x64\", version: \"15.0.4\", filename: \"tor-expert-bundle-linux-x86_64-15.0.4.tar.gz\" })]: \"b9d0cbb76b2d8cca37313393b7b02a931e8b63d58aacbeed18b24d5cbb887fe8\",\r\n    [makePinnedKey({ platform: \"darwin\", arch: \"arm64\", version: \"15.0.4\", filename: \"tor-expert-bundle-macos-aarch64-15.0.4.tar.gz\" })]: \"8f0a9dc1020b2d7a89356a6aabefb95663614b132790ea484381ccb669e2d255\",\r\n    [makePinnedKey({ platform: \"darwin\", arch: \"x64\", version: \"15.0.4\", filename: \"tor-expert-bundle-macos-x86_64-15.0.4.tar.gz\" })]: \"1577938b499f46b8cdfa6643c4bb982309ee48fcaa08e3d32ac64e2dd8c16830\",\r\n    [makePinnedKey({ platform: \"win32\", arch: \"ia32\", version: \"15.0.4\", filename: \"tor-expert-bundle-windows-i686-15.0.4.tar.gz\" })]: \"f1da12f12f0b49ffbbbe99d7a1994b5f7f5e6ced33e4f41d3a520d0d9c445a21\",\r\n    [makePinnedKey({ platform: \"win32\", arch: \"x64\", version: \"15.0.4\", filename: \"tor-expert-bundle-windows-x86_64-15.0.4.tar.gz\" })]: \"cce12f8097b1657b56e22ec54cbed4b57fd5f8ff97cc426c21ebd5cc15173924\",\r\n  },\r\n  lokinet: {\n    [makePinnedKey({ platform: \"linux\", arch: \"x64\", version: \"0.9.14\", filename: \"lokinet-linux-amd64-v0.9.14.tar.xz\" })]: \"4097f96779a007abf35f37a46394eb5af39debd27244c190ce6867caf7a5115d\",\n    [makePinnedKey({ platform: \"win32\", arch: \"x64\", version: \"0.9.11\", filename: \"lokinet-0.9.11-win64.exe\" })]: \"0a4a972e1f2d7d2af7f6aebcd15953d98f4ff53b5e823a7d7aa2953eeea2c8d2\",\n  },\n} as const;\n","import path from \"node:path\";\r\nimport type { OnionNetwork } from \"../../net/netConfig\";\r\nimport { makePinnedKey, pinnedSha256 } from \"./pinnedHashes\";\r\n\r\nexport type ComponentDownload = {\r\n  version: string;\r\n  assetName: string;\r\n  url: string;\r\n  sha256: string;\r\n};\r\n\r\ntype ComponentRegistryEntry = {\r\n  id: OnionNetwork;\r\n  displayName: string;\r\n  binaryPath: (platform: NodeJS.Platform) => string;\r\n  pinnedSha256: Record<string, string>;\r\n};\r\n\r\nconst withExeSuffix = (platform: NodeJS.Platform, basename: string) =>\r\n  platform === \"win32\" ? `${basename}.exe` : basename;\r\n\r\nconst torEntry: ComponentRegistryEntry = {\r\n  id: \"tor\",\r\n  displayName: \"Tor\",\r\n  binaryPath: (platform) => path.join(\"Tor\", withExeSuffix(platform, \"tor\")),\r\n  pinnedSha256: pinnedSha256.tor,\r\n};\r\n\r\nconst lokinetEntry: ComponentRegistryEntry = {\r\n  id: \"lokinet\",\r\n  displayName: \"Lokinet\",\r\n  binaryPath: (platform) => withExeSuffix(platform, \"lokinet\"),\r\n  pinnedSha256: pinnedSha256.lokinet,\r\n};\r\n\r\nexport const componentRegistry: Record<OnionNetwork, ComponentRegistryEntry> = {\r\n  tor: torEntry,\r\n  lokinet: lokinetEntry,\r\n};\r\n\r\nexport const getBinaryPath = (network: OnionNetwork, platform: NodeJS.Platform = process.platform) =>\r\n  componentRegistry[network].binaryPath(platform);\r\n\r\nexport type PinnedHashLookup = {\r\n  platform?: NodeJS.Platform;\r\n  arch?: NodeJS.Architecture;\r\n  version: string;\r\n  assetName: string;\r\n};\r\n\r\nexport const getPinnedSha256 = (network: OnionNetwork, lookup: PinnedHashLookup) => {\r\n  const key = makePinnedKey({\r\n    platform: lookup.platform ?? process.platform,\r\n    arch: lookup.arch ?? process.arch,\r\n    version: lookup.version,\r\n    filename: lookup.assetName,\r\n  });\r\n  return componentRegistry[network].pinnedSha256[key];\r\n};\r\n","import fs from \"node:fs/promises\";\r\nimport path from \"node:path\";\r\nimport type { OnionNetwork } from \"../../../net/netConfig\";\r\n\r\ntype CurrentPointer = {\r\n  version: string;\r\n  path: string;\r\n};\r\n\r\nconst currentFileName = \"current.json\";\r\n\r\nconst getComponentRoot = (userDataDir: string, network: OnionNetwork) =>\r\n  path.join(userDataDir, \"onion\", \"components\", network);\r\n\r\nconst getPointerPath = (userDataDir: string, network: OnionNetwork) =>\r\n  path.join(getComponentRoot(userDataDir, network), currentFileName);\r\n\r\nconst writeJsonAtomic = async (filePath: string, data: CurrentPointer) => {\r\n  const tempPath = `${filePath}.tmp`;\r\n  await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n  await fs.writeFile(tempPath, JSON.stringify(data, null, 2));\r\n  await fs.rename(tempPath, filePath);\r\n};\r\n\r\nexport const readCurrentPointer = async (userDataDir: string, network: OnionNetwork) => {\r\n  try {\r\n    const raw = await fs.readFile(getPointerPath(userDataDir, network), \"utf8\");\r\n    return JSON.parse(raw) as CurrentPointer;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const swapWithRollback = async (\r\n  userDataDir: string,\r\n  network: OnionNetwork,\r\n  next: CurrentPointer\r\n) => {\r\n  const previous = await readCurrentPointer(userDataDir, network);\r\n  await writeJsonAtomic(getPointerPath(userDataDir, network), next);\r\n  return async () => {\r\n    if (previous) {\r\n      await writeJsonAtomic(getPointerPath(userDataDir, network), previous);\r\n    }\r\n  };\r\n};\r\n","export class PinnedHashMissingError extends Error {\r\n  readonly code = \"PINNED_HASH_MISSING\";\r\n  readonly details: string;\r\n\r\n  constructor(details: string) {\r\n    super(\"PINNED_HASH_MISSING\");\r\n    this.name = \"PinnedHashMissingError\";\r\n    this.details = details;\r\n  }\r\n}\r\n","const TOR_RELEASE_BASE = \"https://dist.torproject.org/torbrowser\";\r\nconst LOKINET_RELEASE_BASE = \"https://github.com/oxen-io/lokinet/releases/download\";\r\n\r\nconst getTorPlatformLabel = (platform: NodeJS.Platform) => {\r\n  switch (platform) {\r\n    case \"win32\":\r\n      return \"windows\";\r\n    case \"darwin\":\r\n      return \"macos\";\r\n    case \"linux\":\r\n      return \"linux\";\r\n    case \"android\":\r\n      return \"android\";\r\n    default:\r\n      return platform;\r\n  }\r\n};\r\n\r\nconst getTorArchLabel = (arch: NodeJS.Architecture) => {\r\n  switch (arch) {\r\n    case \"x64\":\r\n      return \"x86_64\";\r\n    case \"ia32\":\r\n      return \"i686\";\r\n    case \"arm64\":\r\n      return \"aarch64\";\r\n    case \"arm\":\r\n      return \"armv7\";\r\n    default:\r\n      return arch;\r\n  }\r\n};\r\n\r\nexport const getTorAssetName = (\r\n  version: string,\r\n  platform: NodeJS.Platform = process.platform,\r\n  arch: NodeJS.Architecture = process.arch\r\n) =>\r\n  `tor-expert-bundle-${getTorPlatformLabel(platform)}-${getTorArchLabel(arch)}-${version}.tar.gz`;\r\n\r\nexport const getTorAssetUrl = (\r\n  version: string,\r\n  platform: NodeJS.Platform = process.platform,\r\n  arch: NodeJS.Architecture = process.arch\r\n) => `${TOR_RELEASE_BASE}/${version}/${getTorAssetName(version, platform, arch)}`;\r\n\r\nconst getLokinetPlatformLabel = (platform: NodeJS.Platform) => {\r\n  switch (platform) {\r\n    case \"win32\":\r\n      return \"win32\";\r\n    case \"darwin\":\r\n      return \"macos\";\r\n    case \"linux\":\r\n      return \"linux\";\r\n    default:\r\n      return platform;\r\n  }\r\n};\r\n\r\nconst getLokinetArchLabel = (arch: NodeJS.Architecture) => {\r\n  switch (arch) {\r\n    case \"x64\":\r\n      return \"amd64\";\r\n    case \"ia32\":\r\n      return \"i686\";\r\n    case \"arm64\":\r\n      return \"arm64\";\r\n    default:\r\n      return arch;\r\n  }\r\n};\r\n\r\nconst getLokinetAssetExtension = (platform: NodeJS.Platform) => {\r\n  switch (platform) {\r\n    case \"linux\":\r\n    case \"darwin\":\r\n      return \"tar.xz\";\r\n    default:\r\n      return \"zip\";\r\n  }\r\n};\r\n\r\nexport const getLokinetAssetName = (\r\n  version: string,\r\n  platform: NodeJS.Platform = process.platform,\r\n  arch: NodeJS.Architecture = process.arch\r\n) =>\r\n  `lokinet-${getLokinetPlatformLabel(platform)}-${getLokinetArchLabel(arch)}-v${version}.${getLokinetAssetExtension(\r\n    platform\r\n  )}`;\r\n\r\nexport const getLokinetAssetUrl = (\r\n  version: string,\r\n  platform: NodeJS.Platform = process.platform,\r\n  arch: NodeJS.Architecture = process.arch\r\n) => `${LOKINET_RELEASE_BASE}/v${version}/${getLokinetAssetName(version, platform, arch)}`;\r\n\r\nexport const getLokinetAssetUrlForName = (version: string, assetName: string) =>\r\n  `${LOKINET_RELEASE_BASE}/v${version}/${assetName}`;\r\n","import fs from \"node:fs/promises\";\r\nimport fsSync from \"node:fs\";\r\nimport path from \"node:path\";\r\nimport type { OnionNetwork } from \"../../../net/netConfig\";\r\nimport { downloadFile } from \"./downloader\";\r\nimport { verifySha256 } from \"./verify\";\r\nimport { unpackArchive } from \"./unpack\";\r\nimport { getBinaryPath, getPinnedSha256 } from \"../componentRegistry\";\r\nimport { swapWithRollback } from \"./swapperRollback\";\r\nimport { PinnedHashMissingError } from \"../errors\";\r\nimport { getTorAssetName, getTorAssetUrl } from \"../assetNaming\";\r\n\r\ntype InstallProgress = {\r\n  step: \"download\" | \"verify\" | \"unpack\" | \"activate\";\r\n  message?: string;\r\n  receivedBytes?: number;\r\n  totalBytes?: number;\r\n};\r\n\r\ntype InstallResult = {\r\n  version: string;\r\n  installPath: string;\r\n  rollback: () => Promise<void>;\r\n};\r\n\r\nconst resolveDownload = (version: string) => {\r\n  const assetName = getTorAssetName(version);\r\n  return {\r\n    assetName,\r\n    url: getTorAssetUrl(version),\r\n  };\r\n};\r\n\r\nexport const installTor = async (\r\n  userDataDir: string,\r\n  version: string,\r\n  onProgress?: (progress: InstallProgress) => void,\r\n  downloadUrl?: string,\r\n  assetNameOverride?: string\r\n): Promise<InstallResult> => {\r\n  const network: OnionNetwork = \"tor\";\r\n  const { assetName, url } = resolveDownload(version);\r\n  const resolvedAssetName = assetNameOverride ?? assetName;\r\n  const hash = getPinnedSha256(network, { version, assetName: resolvedAssetName });\r\n  if (!hash) {\r\n    throw new PinnedHashMissingError(\r\n      `Missing pinned hash for Tor asset ${resolvedAssetName} (${version}).`\r\n    );\r\n  }\r\n\r\n  const baseOnionDir = path.join(userDataDir, \"onion\");\r\n  await fs.mkdir(baseOnionDir, { recursive: true });\r\n  const tempDir = await fs.mkdtemp(path.join(baseOnionDir, \"tmp-\"));\n  const resolvedUrl = downloadUrl ?? url;\n  const archivePath = path.join(tempDir, resolvedAssetName);\n  const installPath = path.join(userDataDir, \"onion\", \"components\", network, version);\n  const details: Record<string, unknown> = {\r\n    network,\r\n    version,\r\n    assetName: resolvedAssetName,\r\n    downloadUrl: resolvedUrl,\r\n    archivePath,\r\n    installPath,\r\n  };\r\n\r\n  try {\n    onProgress?.({ step: \"download\", message: \"Downloading Tor\" });\n    await downloadFile(resolvedUrl, archivePath, (progress) =>\n      onProgress?.({ step: \"download\", ...progress })\n    );\n    const stat = await fs.stat(archivePath);\r\n    details.downloadBytes = stat.size;\r\n\r\n    onProgress?.({ step: \"verify\", message: \"Verifying Tor\" });\r\n    await verifySha256(archivePath, hash);\r\n    details.expectedSha256 = hash;\r\n\r\n    await fs.rm(installPath, { recursive: true, force: true });\r\n    await fs.mkdir(installPath, { recursive: true });\r\n    onProgress?.({ step: \"unpack\", message: \"Unpacking Tor\" });\r\n    await unpackArchive(archivePath, installPath);\r\n    const binaryPath = path.join(installPath, getBinaryPath(network));\r\n    details.binaryPath = binaryPath;\r\n    if (!fsSync.existsSync(binaryPath)) {\r\n      throw new Error(`BINARY_MISSING: ${binaryPath}`);\r\n    }\r\n\r\n    onProgress?.({ step: \"activate\", message: \"Activating Tor\" });\n    const rollback = await swapWithRollback(userDataDir, network, { version, path: installPath });\n    return { version, installPath, rollback };\n  } catch (error) {\n    if (error && typeof error === \"object\") {\r\n      const err = error as { expected?: string; actual?: string };\r\n      if (err.expected) details.expectedSha256 = err.expected;\r\n      if (err.actual) details.actualSha256 = err.actual;\r\n    }\r\n    const message = error instanceof Error ? error.message : String(error);\r\n    console.error(\"[onion] Tor install failed\", { message, details });\r\n    const wrapped = new Error(`${message} | details=${JSON.stringify(details)}`);\n    (wrapped as { details?: Record<string, unknown> }).details = details;\n    throw wrapped;\n  } finally {\n    await fs.rm(tempDir, { recursive: true, force: true });\n  }\n};\n","import fs from \"node:fs/promises\";\nimport fsSync from \"node:fs\";\nimport path from \"node:path\";\nimport { execFile } from \"node:child_process\";\nimport type { OnionNetwork } from \"../../../net/netConfig\";\nimport { downloadFile } from \"./downloader\";\nimport { verifySha256 } from \"./verify\";\nimport { unpackArchive } from \"./unpack\";\nimport { getBinaryPath, getPinnedSha256 } from \"../componentRegistry\";\nimport { swapWithRollback } from \"./swapperRollback\";\r\nimport { PinnedHashMissingError } from \"../errors\";\r\nimport { getLokinetAssetName, getLokinetAssetUrlForName } from \"../assetNaming\";\r\n\r\ntype InstallProgress = {\r\n  step: \"download\" | \"verify\" | \"unpack\" | \"activate\";\r\n  message?: string;\r\n  receivedBytes?: number;\r\n  totalBytes?: number;\r\n};\r\n\r\ntype InstallResult = {\n  version: string;\n  installPath: string;\n  rollback: () => Promise<void>;\n};\n\nconst runInstaller = async (filePath: string) => {\n  if (process.platform !== \"win32\") {\n    throw new Error(\"Installer execution is only supported on Windows\");\n  }\n  const escapedPath = filePath.replace(/'/g, \"''\");\n  const psCommand = `Start-Process -FilePath '${escapedPath}' -ArgumentList '/S' -Verb RunAs -Wait`;\n  await new Promise<void>((resolve, reject) => {\n    execFile(\n      \"powershell.exe\",\n      [\"-NoProfile\", \"-NonInteractive\", \"-Command\", psCommand],\n      { windowsHide: true },\n      (error, stdout, stderr) => {\n        if (error) {\n          const wrapped = new Error(\n            `${error.message}\\n${stderr || stdout || \"\"}`.trim()\n          );\n          (wrapped as { details?: Record<string, unknown> }).details = {\n            filePath,\n            stderr: stderr?.toString?.() ?? String(stderr ?? \"\"),\n            stdout: stdout?.toString?.() ?? String(stdout ?? \"\"),\n            code: (error as unknown as { code?: string }).code,\n          };\n          reject(wrapped);\n          return;\n        }\n        void stdout;\n        void stderr;\n        resolve();\n      }\n    );\n  });\n};\n\nconst findLokinetBinaryWin32 = async () => {\n  const candidates: string[] = [];\n  await new Promise<void>((resolve) => {\n    execFile(\"where.exe\", [\"lokinet.exe\"], { windowsHide: true }, (_error, stdout) => {\n      if (stdout) {\n        candidates.push(\n          ...stdout\n            .toString()\n            .split(/\\r?\\n/)\n            .map((line) => line.trim())\n            .filter(Boolean)\n        );\n      }\n      resolve();\n    });\n  });\n\n  candidates.push(\n    \"C:\\\\\\\\Program Files\\\\\\\\Lokinet\\\\\\\\lokinet.exe\",\n    \"C:\\\\\\\\Program Files (x86)\\\\\\\\Lokinet\\\\\\\\lokinet.exe\",\n    \"C:\\\\\\\\Program Files\\\\\\\\Lokinet\\\\\\\\lokinet\\\\\\\\lokinet.exe\",\n    \"C:\\\\\\\\Program Files (x86)\\\\\\\\Lokinet\\\\\\\\lokinet\\\\\\\\lokinet.exe\"\n  );\n\n  const ps = async (command: string) => {\n    return new Promise<string>((resolve) => {\n      execFile(\n        \"powershell.exe\",\n        [\"-NoProfile\", \"-NonInteractive\", \"-Command\", command],\n        { windowsHide: true },\n        (_error, stdout) => resolve((stdout ?? \"\").toString())\n      );\n    });\n  };\n\n  // Registry install location (most reliable).\n  const installLocationsRaw = await ps(\n    \"$paths=@(); \" +\n      \"$roots=@('HKLM:\\\\\\\\Software\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\CurrentVersion\\\\\\\\Uninstall\\\\\\\\*','HKLM:\\\\\\\\Software\\\\\\\\WOW6432Node\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\CurrentVersion\\\\\\\\Uninstall\\\\\\\\*'); \" +\n      \"foreach($r in $roots){ \" +\n      \"  Get-ItemProperty $r -ErrorAction SilentlyContinue | \" +\n      \"    Where-Object { $_.DisplayName -match 'Lokinet' -or $_.DisplayName -match 'lokinet' } | \" +\n      \"    ForEach-Object { if($_.InstallLocation){$paths+=$_.InstallLocation} } \" +\n      \"}; \" +\n      \"$paths | ForEach-Object { $_.Trim() } | Where-Object { $_ } | Select-Object -Unique | ForEach-Object { $_ }\"\n  );\n  for (const line of installLocationsRaw.split(/\\r?\\n/).map((l) => l.trim()).filter(Boolean)) {\n    candidates.push(path.join(line, \"lokinet.exe\"));\n    candidates.push(path.join(line, \"lokinet\", \"lokinet.exe\"));\n  }\n\n  // Service image path (fallback).\n  const servicePathRaw = await ps(\n    \"(Get-ItemProperty 'HKLM:\\\\\\\\SYSTEM\\\\\\\\CurrentControlSet\\\\\\\\Services\\\\\\\\lokinet' -ErrorAction SilentlyContinue).ImagePath\"\n  );\n  const servicePath = servicePathRaw.trim().replace(/^\\\"|\\\"$/g, \"\");\n  if (servicePath) {\n    // ImagePath may include args; take the exe portion.\n    const exePath = servicePath.split(/\\s+/)[0].replace(/^\\\"|\\\"$/g, \"\");\n    candidates.push(exePath);\n    candidates.push(path.join(path.dirname(exePath), \"lokinet.exe\"));\n  }\n\n  for (const file of candidates) {\n    if (fsSync.existsSync(file)) {\n      return { binaryPath: file, baseDir: path.dirname(file) };\n    }\n  }\n  return null;\n};\n\nconst resolveDownload = (version: string, assetNameOverride?: string) => {\n  const assetName = assetNameOverride ?? getLokinetAssetName(version);\n  return {\n    assetName,\n    url: getLokinetAssetUrlForName(version, assetName),\r\n  };\r\n};\r\n\r\nexport const installLokinet = async (\n  userDataDir: string,\n  version: string,\n  onProgress?: (progress: InstallProgress) => void,\n  downloadUrl?: string,\n  assetNameOverride?: string\n): Promise<InstallResult> => {\n  const network: OnionNetwork = \"lokinet\";\n  const { assetName, url } = resolveDownload(version, assetNameOverride);\n  const hash = getPinnedSha256(network, { version, assetName });\n  if (!hash) {\n    throw new PinnedHashMissingError(\n      `Missing pinned hash for Lokinet asset ${assetName} (${version}).`\n    );\n  }\n\n  const baseOnionDir = path.join(userDataDir, \"onion\");\n  await fs.mkdir(baseOnionDir, { recursive: true });\n  const tempDir = await fs.mkdtemp(path.join(baseOnionDir, \"tmp-\"));\n  const resolvedUrl = downloadUrl ?? url;\n  const archivePath = path.join(tempDir, assetName);\n  const installPath = path.join(userDataDir, \"onion\", \"components\", network, version);\n  const details: Record<string, unknown> = {\n    network,\n    version,\n    assetName,\n    downloadUrl: resolvedUrl,\n    archivePath,\n    installPath,\n  };\n  onProgress?.({ step: \"download\", message: \"Downloading Lokinet\" });\n  try {\n    await downloadFile(resolvedUrl, archivePath, (progress) =>\n      onProgress?.({ step: \"download\", ...progress })\n    );\n    const stat = await fs.stat(archivePath);\n    details.downloadBytes = stat.size;\n\n    onProgress?.({ step: \"verify\", message: \"Verifying Lokinet\" });\n    await verifySha256(archivePath, hash);\n    details.expectedSha256 = hash;\n\n    if (process.platform === \"win32\" && assetName.toLowerCase().endsWith(\".exe\")) {\n      onProgress?.({ step: \"activate\", message: \"Installing Lokinet (requires admin)\" });\n      await runInstaller(archivePath);\n      const found = await findLokinetBinaryWin32();\n      if (!found) {\n        throw new Error(\"BINARY_MISSING: lokinet.exe not found after installer\");\n      }\n      details.binaryPath = found.binaryPath;\n      const rollback = await swapWithRollback(userDataDir, network, {\n        version,\n        path: found.baseDir,\n      });\n      return { version, installPath: found.baseDir, rollback };\n    }\n\n    await fs.rm(installPath, { recursive: true, force: true });\n    await fs.mkdir(installPath, { recursive: true });\n    onProgress?.({ step: \"unpack\", message: \"Unpacking Lokinet\" });\n    await unpackArchive(archivePath, installPath);\n    const binaryPath = path.join(installPath, getBinaryPath(network));\n    details.binaryPath = binaryPath;\n    if (!fsSync.existsSync(binaryPath)) {\n      throw new Error(`BINARY_MISSING: ${binaryPath}`);\n    }\n    onProgress?.({ step: \"activate\", message: \"Activating Lokinet\" });\n    const rollback = await swapWithRollback(userDataDir, network, { version, path: installPath });\n    return { version, installPath, rollback };\n  } catch (error) {\n    if (error && typeof error === \"object\") {\n      const err = error as { expected?: string; actual?: string };\n      if (err.expected) details.expectedSha256 = err.expected;\n      if (err.actual) details.actualSha256 = err.actual;\n    }\n    const message = error instanceof Error ? error.message : String(error);\n    console.error(\"[onion] Lokinet install failed\", { message, details });\n    const wrapped = new Error(`${message} | details=${JSON.stringify(details)}`);\n    (wrapped as { details?: Record<string, unknown> }).details = details;\n    throw wrapped;\n  } finally {\n    await fs.rm(tempDir, { recursive: true, force: true });\n  }\n};\n","import { spawn } from \"node:child_process\";\r\nimport type { ChildProcess } from \"node:child_process\";\r\n\r\ntype TorManagerState = {\r\n  running: boolean;\r\n  pid?: number;\r\n};\r\n\r\nexport class TorManager {\r\n  private process: ChildProcess | null = null;\r\n  private state: TorManagerState = { running: false };\r\n\r\n  async start(binaryPath: string, socksPort: number, dataDir: string) {\r\n    if (this.process) return;\r\n    const args = [\"--SocksPort\", `127.0.0.1:${socksPort}`, \"--DataDirectory\", dataDir];\r\n    this.process = spawn(binaryPath, args, { stdio: \"ignore\" });\r\n    this.state = { running: true, pid: this.process.pid };\r\n    this.process.on(\"exit\", () => {\r\n      this.state = { running: false };\r\n      this.process = null;\r\n    });\r\n  }\r\n\r\n  async stop() {\r\n    if (!this.process) return;\r\n    this.process.kill();\r\n    this.process = null;\r\n    this.state = { running: false };\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n}\r\n","import { spawn } from \"node:child_process\";\r\nimport type { ChildProcess } from \"node:child_process\";\r\n\r\ntype LokinetManagerState = {\r\n  running: boolean;\r\n  pid?: number;\r\n};\r\n\r\nexport class LokinetManager {\r\n  private process: ChildProcess | null = null;\r\n  private state: LokinetManagerState = { running: false };\r\n\r\n  async start(binaryPath: string, socksPort: number, dataDir: string) {\r\n    if (this.process) return;\r\n    const args = [\"--socks-port\", String(socksPort), \"--data-dir\", dataDir];\r\n    this.process = spawn(binaryPath, args, { stdio: \"ignore\" });\r\n    this.state = { running: true, pid: this.process.pid };\r\n    this.process.on(\"exit\", () => {\r\n      this.state = { running: false };\r\n      this.process = null;\r\n    });\r\n  }\r\n\r\n  async stop() {\r\n    if (!this.process) return;\r\n    this.process.kill();\r\n    this.process = null;\r\n    this.state = { running: false };\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n}\r\n","import net from \"node:net\";\r\nimport path from \"node:path\";\r\nimport fs from \"node:fs/promises\";\r\nimport fsSync from \"node:fs\";\r\nimport { session } from \"electron\";\r\nimport { getBinaryPath } from \"../componentRegistry\";\r\nimport type { OnionNetwork } from \"../../../net/netConfig\";\r\nimport { readCurrentPointer } from \"../install/swapperRollback\";\r\nimport { TorManager } from \"./torManager\";\r\nimport { LokinetManager } from \"./lokinetManager\";\r\n\r\ntype RuntimeStatus = {\r\n  status: \"idle\" | \"starting\" | \"running\" | \"failed\";\r\n  network?: OnionNetwork;\r\n  socksPort?: number;\r\n  error?: string;\r\n};\r\n\r\nconst PORT_START = 9050;\r\nconst PORT_END = 9070;\r\n\r\nconst findAvailablePort = async () => {\r\n  for (let port = PORT_START; port <= PORT_END; port += 1) {\r\n    const isFree = await new Promise<boolean>((resolve) => {\r\n      const server = net.createServer();\r\n      server.once(\"error\", () => resolve(false));\r\n      server.once(\"listening\", () => {\r\n        server.close(() => resolve(true));\r\n      });\r\n      server.listen(port, \"127.0.0.1\");\r\n    });\r\n    if (isFree) return port;\r\n  }\r\n  throw new Error(\"No available SOCKS port\");\r\n};\r\n\r\nconst waitForPort = async (port: number, timeoutMs = 30000) => {\r\n  const start = Date.now();\r\n  while (Date.now() - start < timeoutMs) {\r\n    const ok = await new Promise<boolean>((resolve) => {\r\n      const socket = net.createConnection({ host: \"127.0.0.1\", port }, () => {\r\n        socket.end();\r\n        resolve(true);\r\n      });\r\n      socket.on(\"error\", () => resolve(false));\r\n    });\r\n    if (ok) return;\r\n    await new Promise((resolve) => setTimeout(resolve, 250));\r\n  }\r\n  throw new Error(`SOCKS proxy not ready (port ${port})`);\r\n};\r\n\r\nexport class OnionRuntime {\r\n  private torManager = new TorManager();\r\n  private lokinetManager = new LokinetManager();\r\n  private status: RuntimeStatus = { status: \"idle\" };\r\n\r\n  async start(userDataDir: string, network: OnionNetwork) {\r\n    if (this.status.status === \"running\" && this.status.network === network) return;\r\n    await this.stop();\r\n    this.status = { status: \"starting\", network };\r\n    try {\r\n      const pointer = await readCurrentPointer(userDataDir, network);\r\n      if (!pointer) {\r\n        throw new Error(\"Component not installed\");\r\n      }\r\n\r\n      const port = await findAvailablePort();\r\n      const dataDir = path.join(userDataDir, \"onion\", \"runtime\", network);\r\n      await fs.mkdir(dataDir, { recursive: true });\r\n      const binaryPath = path.join(pointer.path, getBinaryPath(network));\r\n      if (!fsSync.existsSync(binaryPath)) {\r\n        throw new Error(`BINARY_MISSING: ${binaryPath}`);\r\n      }\r\n\r\n      if (network === \"tor\") {\r\n        await this.torManager.start(binaryPath, port, dataDir);\r\n      } else {\r\n        await this.lokinetManager.start(binaryPath, port, dataDir);\r\n      }\r\n\r\n      await waitForPort(port);\r\n      await session.defaultSession.setProxy({ proxyRules: `socks5://127.0.0.1:${port}` });\r\n      this.status = { status: \"running\", network, socksPort: port };\r\n    } catch (error) {\r\n      this.status = {\r\n        status: \"failed\",\r\n        network,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      };\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async stop() {\r\n    await this.torManager.stop();\r\n    await this.lokinetManager.stop();\r\n    await session.defaultSession.setProxy({ mode: \"direct\" });\r\n    this.status = { status: \"idle\" };\r\n  }\r\n\r\n  getStatus() {\r\n    return {\r\n      ...this.status,\r\n      tor: this.torManager.getState(),\r\n      lokinet: this.lokinetManager.getState(),\r\n    };\r\n  }\r\n}\r\n","import https from \"node:https\";\r\nimport type { OnionNetwork } from \"../../../net/netConfig\";\r\nimport { getPinnedSha256 } from \"../componentRegistry\";\r\nimport { getTorAssetName, getTorAssetUrl } from \"../assetNaming\";\r\n\r\ntype ReleaseAsset = {\r\n  name: string;\r\n  browser_download_url: string;\r\n};\r\n\r\ntype ReleaseResponse = {\r\n  tag_name: string;\r\n  assets: ReleaseAsset[];\r\n};\r\n\r\ntype UpdateCheckResult = {\n  version: string | null;\n  assetName: string | null;\n  downloadUrl: string | null;\n  sha256: string | null;\n  errorCode?: \"PINNED_HASH_MISSING\" | \"ASSET_NOT_FOUND\";\n};\n\r\nconst fetchJson = async <T,>(url: string): Promise<T> => {\r\n  return new Promise((resolve, reject) => {\r\n    https\r\n      .get(\r\n        url,\r\n        { headers: { \"User-Agent\": \"nkc-onion-updater\" } },\r\n        (res) => {\r\n          if (res.statusCode && res.statusCode >= 400) {\r\n            reject(new Error(`Update check failed: ${res.statusCode}`));\r\n            return;\r\n          }\r\n          let raw = \"\";\r\n          res.setEncoding(\"utf8\");\r\n          res.on(\"data\", (chunk) => {\r\n            raw += chunk;\r\n          });\r\n          res.on(\"end\", () => {\r\n            try {\r\n              resolve(JSON.parse(raw) as T);\r\n            } catch (error) {\r\n              reject(error);\r\n            }\r\n          });\r\n        }\r\n      )\r\n      .on(\"error\", reject);\r\n  });\r\n};\r\n\r\nconst fetchText = async (url: string): Promise<string> => {\r\n  return new Promise((resolve, reject) => {\r\n    https\r\n      .get(url, { headers: { \"User-Agent\": \"nkc-onion-updater\" } }, (res) => {\r\n        if (res.statusCode && res.statusCode >= 400) {\r\n          reject(new Error(`Update check failed: ${res.statusCode}`));\r\n          return;\r\n        }\r\n        let raw = \"\";\r\n        res.setEncoding(\"utf8\");\r\n        res.on(\"data\", (chunk) => {\r\n          raw += chunk;\r\n        });\r\n        res.on(\"end\", () => resolve(raw));\r\n      })\r\n      .on(\"error\", reject);\r\n  });\r\n};\r\n\r\nexport const compareVersions = (a: string, b: string) => {\r\n  const aParts = a.replace(/^v/i, \"\").split(\".\").map(Number);\r\n  const bParts = b.replace(/^v/i, \"\").split(\".\").map(Number);\r\n  const len = Math.max(aParts.length, bParts.length);\r\n  for (let i = 0; i < len; i += 1) {\r\n    const aVal = aParts[i] ?? 0;\r\n    const bVal = bParts[i] ?? 0;\r\n    if (aVal > bVal) return 1;\r\n    if (aVal < bVal) return -1;\r\n  }\r\n  return 0;\r\n};\r\n\r\nconst getPlatformMatchers = () => {\n  const platformMatchers: RegExp[] = [];\n  switch (process.platform) {\n    case \"win32\":\n      platformMatchers.push(/win32/i, /windows/i, /win/i);\n      break;\n    case \"darwin\":\n      platformMatchers.push(/macos/i, /darwin/i, /osx/i, /mac/i);\n      break;\n    case \"linux\":\n      platformMatchers.push(/linux/i);\r\n      break;\r\n    case \"android\":\r\n      platformMatchers.push(/android/i);\r\n      break;\r\n    default:\r\n      platformMatchers.push(new RegExp(process.platform, \"i\"));\r\n      break;\r\n  }\r\n\r\n  const archMatchers: RegExp[] = [];\n  switch (process.arch) {\n    case \"x64\":\n      archMatchers.push(/x86_64/i, /amd64/i, /win64/i, /64bit/i);\n      break;\n    case \"ia32\":\n      archMatchers.push(/i686/i, /x86(?!_64)/i, /win32/i, /32bit/i);\n      break;\n    case \"arm64\":\n      archMatchers.push(/arm64/i, /aarch64/i);\n      break;\n    case \"arm\":\r\n      archMatchers.push(/armv7/i, /arm(?!64)/i);\r\n      break;\r\n    default:\r\n      archMatchers.push(new RegExp(process.arch, \"i\"));\r\n      break;\r\n  }\r\n\r\n  return { platformMatchers, archMatchers };\n};\n\nconst selectReleaseAsset = (assets: ReleaseAsset[]) => {\n  const { platformMatchers, archMatchers } = getPlatformMatchers();\n  return assets.find((asset) => {\r\n    if (asset.name.endsWith(\".asc\") || asset.name.endsWith(\".sig\")) return false;\r\n    const platformMatch = platformMatchers.some((pattern) => pattern.test(asset.name));\r\n    const archMatch = archMatchers.some((pattern) => pattern.test(asset.name));\r\n    return platformMatch && archMatch;\r\n  });\n};\n\nconst fetchReleases = async () => {\n  const url = \"https://api.github.com/repos/oxen-io/lokinet/releases?per_page=20\";\n  return fetchJson<ReleaseResponse[]>(url);\n};\n\nconst checkTorUpdates = async (): Promise<UpdateCheckResult> => {\n  const indexHtml = await fetchText(\"https://dist.torproject.org/torbrowser/\");\r\n  const versions = Array.from(indexHtml.matchAll(/href=\"(\\d+\\.\\d+\\.\\d+)\\//g)).map(\r\n    (match) => match[1]\r\n  );\r\n  const latest = versions.sort(compareVersions).at(-1);\r\n  if (!latest) {\r\n    return { version: null, assetName: null, downloadUrl: null, sha256: null };\r\n  }\r\n  const assetName = getTorAssetName(latest);\r\n  const sha256 = getPinnedSha256(\"tor\", { version: latest, assetName });\r\n  if (!sha256) {\r\n    return {\r\n      version: latest,\r\n      assetName,\r\n      downloadUrl: getTorAssetUrl(latest),\r\n      sha256: null,\r\n      errorCode: \"PINNED_HASH_MISSING\",\r\n    };\r\n  }\r\n  return {\r\n    version: latest,\r\n    assetName,\r\n    downloadUrl: getTorAssetUrl(latest),\r\n    sha256,\r\n  };\r\n};\r\n\r\nconst checkLokinetUpdates = async (): Promise<UpdateCheckResult> => {\n  const url = \"https://api.github.com/repos/oxen-io/lokinet/releases/latest\";\n  const release = await fetchJson<ReleaseResponse>(url);\n  let version = release.tag_name.replace(/^v/i, \"\");\n  let asset = selectReleaseAsset(release.assets);\n\n  if (!asset && process.platform === \"win32\") {\n    const releases = await fetchReleases();\n    for (const candidate of releases) {\n      const candidateAsset = selectReleaseAsset(candidate.assets);\n      if (candidateAsset) {\n        const candidateVersion = candidate.tag_name.replace(/^v/i, \"\");\n        const sha256 = getPinnedSha256(\"lokinet\", {\n          version: candidateVersion,\n          assetName: candidateAsset.name,\n        });\n        if (!sha256) continue;\n        version = candidateVersion;\n        asset = candidateAsset;\n        break;\n      }\n    }\n  }\n  if (!asset) {\n    return {\n      version,\n      assetName: null,\n      downloadUrl: null,\n      sha256: null,\n      errorCode: \"ASSET_NOT_FOUND\",\n    };\n  }\n  const sha256 = getPinnedSha256(\"lokinet\", { version, assetName: asset.name });\r\n  if (!sha256) {\r\n    return {\r\n      version,\r\n      assetName: asset.name,\r\n      downloadUrl: asset.browser_download_url,\r\n      sha256: null,\r\n      errorCode: \"PINNED_HASH_MISSING\",\r\n    };\r\n  }\r\n  return {\r\n    version,\r\n    assetName: asset.name,\r\n    downloadUrl: asset.browser_download_url,\r\n    sha256,\r\n  };\r\n};\r\n\r\nexport const checkUpdates = async (network: OnionNetwork) => {\r\n  if (network === \"tor\") {\r\n    return checkTorUpdates();\r\n  }\r\n  return checkLokinetUpdates();\r\n};\r\n","import { app, BrowserWindow, ipcMain, net, session } from \"electron\";\r\nimport fs from \"node:fs/promises\";\r\nimport fsSync from \"node:fs\";\r\nimport path from \"node:path\";\r\nimport type { OnionComponentState, OnionNetwork } from \"./net/netConfig\";\r\nimport { installTor } from \"./main/onion/install/installTor\";\r\nimport { installLokinet } from \"./main/onion/install/installLokinet\";\r\nimport { readCurrentPointer } from \"./main/onion/install/swapperRollback\";\r\nimport { OnionRuntime } from \"./main/onion/runtime/onionRuntime\";\r\nimport { checkUpdates } from \"./main/onion/update/checkUpdates\";\r\nimport { PinnedHashMissingError } from \"./main/onion/errors\";\r\n\r\ntype ProxyApplyPayload = {\r\n  proxyUrl: string;\r\n  enabled: boolean;\r\n  allowRemote: boolean;\r\n};\r\n\r\ntype ProxyHealth = {\r\n  ok: boolean;\r\n  message: string;\r\n};\r\n\r\nconst isDev = !app.isPackaged;\r\n\r\nconst isLocalhostProxyUrl = (proxyUrl: string) => {\r\n  try {\r\n    const parsed = new URL(proxyUrl);\r\n    return parsed.hostname === \"127.0.0.1\" || parsed.hostname === \"localhost\";\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n};\r\n\r\nconst applyProxy = async ({ proxyUrl, enabled, allowRemote }: ProxyApplyPayload) => {\r\n  if (!enabled) {\r\n    await session.defaultSession.setProxy({ mode: \"direct\" });\r\n    return;\r\n  }\r\n  if (!isLocalhostProxyUrl(proxyUrl) && !allowRemote) {\r\n    throw new Error(\"Remote proxy URL blocked\");\r\n  }\r\n  await session.defaultSession.setProxy({ proxyRules: proxyUrl });\r\n};\r\n\r\nconst checkProxy = async (): Promise<ProxyHealth> => {\r\n  const resolve = await session.defaultSession.resolveProxy(\"https://example.com\");\r\n  const hasProxy = resolve.includes(\"PROXY\") || resolve.includes(\"SOCKS\");\r\n  if (!hasProxy) {\r\n    return { ok: false, message: \"proxy-not-applied\" };\r\n  }\r\n\r\n  return new Promise((resolvePromise) => {\r\n    const request = net.request(\"https://example.com\");\r\n    request.on(\"response\", () => resolvePromise({ ok: true, message: \"ok\" }));\r\n    request.on(\"error\", () => resolvePromise({ ok: false, message: \"unreachable\" }));\r\n    request.end();\r\n  });\r\n};\r\n\r\nexport const registerProxyIpc = () => {\r\n  ipcMain.handle(\"proxy:apply\", async (_event, payload: ProxyApplyPayload) => {\r\n    await applyProxy(payload);\r\n  });\r\n  ipcMain.handle(\"proxy:check\", async () => {\r\n    return checkProxy();\r\n  });\r\n};\r\n\r\ntype OnionStatusPayload = {\r\n  components: {\r\n    tor: OnionComponentState;\r\n    lokinet: OnionComponentState;\r\n  };\r\n  runtime: ReturnType<OnionRuntime[\"getStatus\"]>;\r\n};\r\n\r\nconst onionRuntime = new OnionRuntime();\nconst onionComponentCache: Record<OnionNetwork, OnionComponentState> = {\n  tor: { installed: false, status: \"idle\" },\n  lokinet: { installed: false, status: \"idle\" },\n};\n\nconst pruneComponentVersions = async (\n  userDataDir: string,\n  network: OnionNetwork,\n  keep: { version: string; installPath: string }\n) => {\n  const componentsRoot = path.join(userDataDir, \"onion\", \"components\", network);\n  const normalizedRoot = path.resolve(componentsRoot) + path.sep;\n  const normalizedKeep = path.resolve(keep.installPath);\n  if (!normalizedKeep.startsWith(normalizedRoot)) return;\n\n  try {\n    const entries = await fs.readdir(componentsRoot, { withFileTypes: true });\n    await Promise.all(\n      entries\n        .filter((entry) => entry.isDirectory())\n        .map(async (entry) => {\n          if (entry.name === keep.version) return;\n          await fs.rm(path.join(componentsRoot, entry.name), { recursive: true, force: true });\n        })\n    );\n  } catch {\n    // Best-effort cleanup; ignore.\n  }\n};\n\nconst formatProgress = (receivedBytes?: number, totalBytes?: number) => {\n  if (!receivedBytes && !totalBytes) return \"\";\n  const total = totalBytes ?? 0;\n  if (total > 0) {\n    return `${Math.round((receivedBytes ?? 0) / 1024 / 1024)} / ${Math.round(total / 1024 / 1024)} MB`;\n  }\n  return `${Math.round((receivedBytes ?? 0) / 1024 / 1024)} MB`;\n};\n\r\nconst normalizeOnionError = (\n  error: unknown,\n  context: Record<string, unknown>\n) => {\n  const message = error instanceof Error ? error.message : String(error);\n  const errCode =\n    error && typeof error === \"object\" && \"code\" in error\n      ? String((error as { code?: unknown }).code ?? \"\")\n      : \"\";\n  const code =\n    error instanceof PinnedHashMissingError\n      ? \"PINNED_HASH_MISSING\"\n      : message.includes(\"SHA256 mismatch\")\n        ? \"HASH_MISMATCH\"\n        : message.includes(\"Download failed\") ||\r\n            message.includes(\"Too many redirects\") ||\r\n            message.includes(\"Redirect\")\r\n          ? \"DOWNLOAD_FAILED\"\r\n          : message.includes(\"Unsupported archive format\") ||\r\n              message.includes(\"tar\") ||\r\n              message.includes(\"unzip\") ||\r\n              message.includes(\"Expand-Archive\")\n            ? \"EXTRACT_FAILED\"\n            : message.includes(\"BINARY_MISSING\")\n              ? \"BINARY_MISSING\"\n              : (() => {\n                  const err = error as { code?: string };\n                  if (errCode === \"EACCES\" || errCode === \"EPERM\") return \"PERMISSION_DENIED\";\n                  if (err?.code === \"EACCES\" || err?.code === \"EPERM\") return \"PERMISSION_DENIED\";\n                  if (err?.code === \"ENOENT\") return \"FS_ERROR\";\n                  return \"UNKNOWN_ERROR\";\n                })();\n  const details =\r\n    error && typeof error === \"object\" && \"details\" in error\r\n      ? { ...context, ...(error as { details?: Record<string, unknown> }).details }\r\n      : context;\r\n  return { code, message, details };\r\n};\r\n\r\nconst refreshComponentState = async (userDataDir: string, network: OnionNetwork) => {\r\n  const pointer = await readCurrentPointer(userDataDir, network);\r\n  return {\r\n    ...onionComponentCache[network],\r\n    installed: Boolean(pointer),\r\n    version: pointer?.version,\r\n  };\r\n};\r\n\r\nconst emitOnionProgress = (\r\n  event: Electron.IpcMainInvokeEvent,\r\n  network: OnionNetwork,\r\n  status: OnionComponentState\r\n) => {\r\n  event.sender.send(\"onion:progress\", { network, status });\r\n};\r\n\r\nconst registerOnionIpc = () => {\r\n  ipcMain.handle(\"onion:status\", async () => {\r\n    const userDataDir = app.getPath(\"userData\");\r\n    return {\r\n      components: {\r\n        tor: await refreshComponentState(userDataDir, \"tor\"),\r\n        lokinet: await refreshComponentState(userDataDir, \"lokinet\"),\r\n      },\r\n      runtime: onionRuntime.getStatus(),\r\n    } satisfies OnionStatusPayload;\r\n  });\r\n\r\n  ipcMain.handle(\"onion:checkUpdates\", async () => {\n    const userDataDir = app.getPath(\"userData\");\r\n    const torUpdate = await checkUpdates(\"tor\");\r\n    const lokinetUpdate = await checkUpdates(\"lokinet\");\r\n    console.log(\"[onion] checkUpdates\", {\r\n      tor: {\r\n        version: torUpdate.version,\r\n        assetName: torUpdate.assetName,\r\n        downloadUrl: torUpdate.downloadUrl,\r\n        sha256: torUpdate.sha256 ? \"<present>\" : \"<missing>\",\r\n        errorCode: torUpdate.errorCode,\r\n      },\r\n      lokinet: {\r\n        version: lokinetUpdate.version,\r\n        assetName: lokinetUpdate.assetName,\r\n        downloadUrl: lokinetUpdate.downloadUrl,\r\n        sha256: lokinetUpdate.sha256 ? \"<present>\" : \"<missing>\",\r\n        errorCode: lokinetUpdate.errorCode,\r\n      },\r\n    });\r\n    const torState = await refreshComponentState(userDataDir, \"tor\");\r\n    const lokinetState = await refreshComponentState(userDataDir, \"lokinet\");\r\n    const torHasVerifiedUpdate =\r\n      Boolean(torUpdate.version && torUpdate.sha256 && torUpdate.downloadUrl);\r\n    const lokinetHasVerifiedUpdate =\r\n      Boolean(lokinetUpdate.version && lokinetUpdate.sha256 && lokinetUpdate.downloadUrl);\r\n    onionComponentCache.tor = {\n      ...torState,\n      latest: torHasVerifiedUpdate ? torUpdate.version ?? undefined : undefined,\n      error: torUpdate.errorCode === \"PINNED_HASH_MISSING\" ? \"PINNED_HASH_MISSING\" : undefined,\n      detail:\n        torUpdate.errorCode === \"PINNED_HASH_MISSING\"\n          ? `Pinned hash missing for ${torUpdate.assetName ?? torUpdate.version ?? \"unknown\"}`\n          : undefined,\n    };\n    onionComponentCache.lokinet = {\n      ...lokinetState,\n      latest: lokinetHasVerifiedUpdate ? lokinetUpdate.version ?? undefined : undefined,\n      error:\n        lokinetUpdate.errorCode === \"PINNED_HASH_MISSING\" ? \"PINNED_HASH_MISSING\" : undefined,\n      detail:\n        lokinetUpdate.errorCode === \"PINNED_HASH_MISSING\"\n          ? `Pinned hash missing for ${lokinetUpdate.assetName ?? lokinetUpdate.version ?? \"unknown\"}`\n          : undefined,\n    };\n    return {\r\n      components: {\r\n        tor: onionComponentCache.tor,\r\n        lokinet: onionComponentCache.lokinet,\r\n      },\r\n      runtime: onionRuntime.getStatus(),\r\n    } satisfies OnionStatusPayload;\r\n  });\r\n\r\n  ipcMain.handle(\"onion:install\", async (event, payload: { network: OnionNetwork }) => {\n    const userDataDir = app.getPath(\"userData\");\r\n    const network = payload.network;\r\n    let updates: Awaited<ReturnType<typeof checkUpdates>> | null = null;\r\n    try {\n      updates = await checkUpdates(network);\n      if (updates.errorCode === \"PINNED_HASH_MISSING\") {\n        throw new PinnedHashMissingError(\n          `Missing pinned hash for ${network} ${updates.assetName ?? updates.version ?? \"unknown\"}`\n        );\n      }\n      if (!updates.version || !updates.sha256 || !updates.downloadUrl || !updates.assetName) {\n        const err = new Error(\"No verified release available\");\n        (err as { details?: Record<string, unknown> }).details = {\n          network,\n          platform: process.platform,\n          arch: process.arch,\n          update: updates,\n        };\n        throw err;\n      }\n      onionComponentCache[network] = {\n        ...onionComponentCache[network],\n        status: \"downloading\",\n        error: undefined,\n        detail: \"Preparing download\",\n        progress: undefined,\n      };\n      emitOnionProgress(event, network, onionComponentCache[network]);\n      const install =\n        network === \"tor\"\n          ? installTor(\n              userDataDir,\n              updates.version,\n              (progress) => {\n                onionComponentCache[network] = {\n                  ...onionComponentCache[network],\n                  status: progress.step === \"download\" ? \"downloading\" : \"installing\",\n                  detail:\n                    (progress.message ?? \"\") +\n                    (progress.receivedBytes || progress.totalBytes\n                      ? ` (${formatProgress(progress.receivedBytes, progress.totalBytes)})`\n                      : \"\"),\n                  progress:\n                    progress.receivedBytes || progress.totalBytes\n                      ? {\n                          receivedBytes: progress.receivedBytes ?? 0,\n                          totalBytes: progress.totalBytes ?? 0,\n                        }\n                      : undefined,\n                };\n                emitOnionProgress(event, network, onionComponentCache[network]);\n              },\n              updates.downloadUrl ?? undefined,\n              updates.assetName ?? undefined\n            )\n          : installLokinet(\n              userDataDir,\n              updates.version,\n              (progress) => {\n                onionComponentCache[network] = {\n                  ...onionComponentCache[network],\n                  status: progress.step === \"download\" ? \"downloading\" : \"installing\",\n                  detail:\n                    (progress.message ?? \"\") +\n                    (progress.receivedBytes || progress.totalBytes\n                      ? ` (${formatProgress(progress.receivedBytes, progress.totalBytes)})`\n                      : \"\"),\n                  progress:\n                    progress.receivedBytes || progress.totalBytes\n                      ? {\n                          receivedBytes: progress.receivedBytes ?? 0,\n                          totalBytes: progress.totalBytes ?? 0,\n                        }\n                      : undefined,\n                };\n                emitOnionProgress(event, network, onionComponentCache[network]);\n              },\n              updates.downloadUrl ?? undefined,\n              updates.assetName ?? undefined\n            );\n      const result = await install;\n      onionComponentCache[network] = {\n        ...onionComponentCache[network],\n        installed: true,\n        status: \"ready\",\n        version: result.version,\n        error: undefined,\n        detail: `Installed ${result.version}`,\n        progress: undefined,\n      };\n      emitOnionProgress(event, network, onionComponentCache[network]);\n      await pruneComponentVersions(userDataDir, network, {\n        version: result.version,\n        installPath: result.installPath,\n      });\n    } catch (error) {\n      const context = {\n        network,\n        version: updates?.version,\n        assetName: updates?.assetName,\r\n        downloadUrl: updates?.downloadUrl,\r\n        targetDir:\r\n          updates?.version\r\n            ? path.join(userDataDir, \"onion\", \"components\", network, updates.version)\r\n            : undefined,\r\n      };\r\n      const normalized = normalizeOnionError(error, context);\r\n      console.error(\"Onion install failed\", {\r\n        code: normalized.code,\r\n        message: normalized.message,\r\n        details: normalized.details,\r\n      });\r\n      onionComponentCache[network] = {\n        ...onionComponentCache[network],\n        status: \"failed\",\n        error: `[${normalized.code}] ${normalized.message}`,\n        detail: JSON.stringify(normalized.details),\n        progress: undefined,\n      };\n      emitOnionProgress(event, network, onionComponentCache[network]);\n      const wrapped = new Error(`[${normalized.code}] ${normalized.message}`);\r\n      (wrapped as { code?: string; details?: Record<string, unknown> }).code = normalized.code;\r\n      (wrapped as { code?: string; details?: Record<string, unknown> }).details = normalized.details;\r\n      throw wrapped;\r\n    }\r\n  });\r\n\r\n  ipcMain.handle(\"onion:applyUpdate\", async (event, payload: { network: OnionNetwork }) => {\n    const network = payload.network;\r\n    const state = onionComponentCache[network];\r\n    if (!state.latest) {\r\n      throw new Error(\"No update available\");\r\n    }\r\n    const updateInfo = await checkUpdates(network);\r\n    if (updateInfo.errorCode === \"PINNED_HASH_MISSING\") {\r\n      throw new PinnedHashMissingError(\r\n        `Missing pinned hash for ${network} ${updateInfo.assetName ?? updateInfo.version ?? \"unknown\"}`\r\n      );\r\n    }\r\n    if (!updateInfo.version || !updateInfo.sha256 || !updateInfo.downloadUrl || !updateInfo.assetName) {\r\n      throw new Error(\"No verified release available\");\r\n    }\r\n    const updateVersion = updateInfo.version ?? state.latest;\r\n    if (!updateVersion) {\r\n      throw new Error(\"No verified release available\");\r\n    }\r\n    const userDataDir = app.getPath(\"userData\");\r\n    try {\n      const install =\n        network === \"tor\"\n          ? installTor(\n              userDataDir,\n              updateVersion,\n              (progress) => {\n                onionComponentCache[network] = {\n                  ...onionComponentCache[network],\n                  status: progress.step === \"download\" ? \"downloading\" : \"installing\",\n                  detail:\n                    (progress.message ?? \"\") +\n                    (progress.receivedBytes || progress.totalBytes\n                      ? ` (${formatProgress(progress.receivedBytes, progress.totalBytes)})`\n                      : \"\"),\n                  progress:\n                    progress.receivedBytes || progress.totalBytes\n                      ? {\n                          receivedBytes: progress.receivedBytes ?? 0,\n                          totalBytes: progress.totalBytes ?? 0,\n                        }\n                      : undefined,\n                };\n                emitOnionProgress(event, network, onionComponentCache[network]);\n              },\n              updateInfo.downloadUrl ?? undefined,\n              updateInfo.assetName ?? undefined\n            )\n          : installLokinet(\n              userDataDir,\n              updateVersion,\n              (progress) => {\n                onionComponentCache[network] = {\n                  ...onionComponentCache[network],\n                  status: progress.step === \"download\" ? \"downloading\" : \"installing\",\n                  detail:\n                    (progress.message ?? \"\") +\n                    (progress.receivedBytes || progress.totalBytes\n                      ? ` (${formatProgress(progress.receivedBytes, progress.totalBytes)})`\n                      : \"\"),\n                  progress:\n                    progress.receivedBytes || progress.totalBytes\n                      ? {\n                          receivedBytes: progress.receivedBytes ?? 0,\n                          totalBytes: progress.totalBytes ?? 0,\n                        }\n                      : undefined,\n                };\n                emitOnionProgress(event, network, onionComponentCache[network]);\n              },\n              updateInfo.downloadUrl ?? undefined,\n              updateInfo.assetName ?? undefined\n            );\n      const result = await install;\r\n      const runtime = onionRuntime.getStatus();\r\n      if (runtime.status === \"running\" && runtime.network === network) {\r\n        try {\r\n          await onionRuntime.start(userDataDir, network);\r\n        } catch (error) {\r\n          await result.rollback();\r\n          await onionRuntime.start(userDataDir, network);\r\n          throw error;\r\n        }\r\n      }\r\n      onionComponentCache[network] = {\n        ...onionComponentCache[network],\n        installed: true,\n        status: \"ready\",\n        version: result.version,\n        error: undefined,\n        detail: `Installed ${result.version}`,\n        progress: undefined,\n      };\n      emitOnionProgress(event, network, onionComponentCache[network]);\n      await pruneComponentVersions(userDataDir, network, {\n        version: result.version,\n        installPath: result.installPath,\n      });\n    } catch (error) {\n      const context = {\n        network,\n        version: updateVersion,\n        assetName: updateInfo.assetName,\r\n        downloadUrl: updateInfo.downloadUrl,\r\n        targetDir: path.join(userDataDir, \"onion\", \"components\", network, updateVersion),\r\n      };\r\n      const normalized = normalizeOnionError(error, context);\r\n      console.error(\"Onion update failed\", {\r\n        code: normalized.code,\r\n        message: normalized.message,\r\n        details: normalized.details,\r\n      });\r\n      onionComponentCache[network] = {\n        ...onionComponentCache[network],\n        status: \"failed\",\n        error: `[${normalized.code}] ${normalized.message}`,\n        detail: JSON.stringify(normalized.details),\n        progress: undefined,\n      };\n      emitOnionProgress(event, network, onionComponentCache[network]);\n      const wrapped = new Error(`[${normalized.code}] ${normalized.message}`);\r\n      (wrapped as { code?: string; details?: Record<string, unknown> }).code = normalized.code;\r\n      (wrapped as { code?: string; details?: Record<string, unknown> }).details = normalized.details;\r\n      throw wrapped;\r\n    }\r\n  });\r\n\r\n  ipcMain.handle(\"onion:uninstall\", async (_event, payload: { network: OnionNetwork }) => {\r\n    const network = payload.network;\r\n    await onionRuntime.stop();\r\n    const userDataDir = app.getPath(\"userData\");\r\n    const componentRoot = path.join(userDataDir, \"onion\", \"components\", network);\r\n    await fs.rm(componentRoot, { recursive: true, force: true });\r\n    onionComponentCache[network] = { installed: false, status: \"idle\" };\r\n  });\r\n\r\n  ipcMain.handle(\r\n    \"onion:setMode\",\r\n    async (_event, payload: { enabled: boolean; network: OnionNetwork }) => {\r\n      const userDataDir = app.getPath(\"userData\");\r\n      if (!payload.enabled) {\r\n        await onionRuntime.stop();\r\n        return;\r\n      }\r\n      await onionRuntime.start(userDataDir, payload.network);\r\n    }\r\n  );\r\n};\r\n\r\nconst rendererUrl = process.env.VITE_DEV_SERVER_URL;\r\nlet mainWindow: BrowserWindow | null = null;\r\n\r\nconst canReach = async (url: string, timeoutMs = 1200) =>\r\n  new Promise<boolean>((resolve) => {\r\n    try {\r\n      const request = net.request(url);\r\n      const timeout = setTimeout(() => {\r\n        try {\r\n          request.abort();\r\n        } catch {}\r\n        resolve(false);\r\n      }, timeoutMs);\r\n      request.on(\"response\", (response) => {\r\n        const ok = Boolean(response.statusCode && response.statusCode >= 200 && response.statusCode < 400);\r\n        response.on(\"data\", () => {});\r\n        response.on(\"end\", () => {\r\n          clearTimeout(timeout);\r\n          resolve(ok);\r\n        });\r\n      });\r\n      request.on(\"error\", () => {\r\n        clearTimeout(timeout);\r\n        resolve(false);\r\n      });\r\n      request.end();\r\n    } catch (error) {\r\n      resolve(false);\r\n    }\r\n  });\r\n\r\nexport const createMainWindow = () => {\r\n  if (mainWindow && !mainWindow.isDestroyed()) {\r\n    mainWindow.show();\r\n    mainWindow.focus();\r\n    return mainWindow;\r\n  }\r\n  const preloadPath = path.join(__dirname, \"preload.js\");\r\n  const preloadExists = fsSync.existsSync(preloadPath);\r\n  if (isDev && !preloadExists) {\r\n    console.error(\"[dev] preload missing at\", preloadPath);\r\n  }\r\n  const sandboxEnabled = !(isDev && process.env.ELECTRON_DEV_NO_SANDBOX === \"1\");\r\n  const win = new BrowserWindow({\r\n    width: 1280,\r\n    height: 800,\r\n    webPreferences: {\r\n      preload: preloadExists ? preloadPath : undefined,\r\n      contextIsolation: true,\r\n      nodeIntegration: false,\r\n      sandbox: sandboxEnabled,\r\n      allowRunningInsecureContent: false,\r\n    },\r\n  });\r\n  win.webContents.on(\"did-fail-load\", (_event, errorCode, errorDesc, validatedURL) => {\r\n    console.error(\"[main] did-fail-load\", errorCode, errorDesc, validatedURL);\r\n  });\r\n  win.webContents.on(\"render-process-gone\", (_event, details) => {\r\n    console.error(\"[main] render-process-gone\", details);\r\n  });\r\n  win.webContents.on(\"unresponsive\", () => {\r\n    console.error(\"[main] renderer unresponsive\");\r\n  });\r\n  const safeLog = (...args: unknown[]) => {\r\n    if (!process.stdout || !process.stdout.writable) return;\r\n    try {\r\n      console.log(...args);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      const code =\r\n        error && typeof error === \"object\" && \"code\" in error\r\n          ? String((error as { code?: unknown }).code)\r\n          : \"\";\r\n      if (code === \"EPIPE\" || message.includes(\"EPIPE\")) {\r\n        return;\r\n      }\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const ignorePipeError = (error: unknown) => {\r\n    const message = error instanceof Error ? error.message : String(error);\r\n    const code =\r\n      error && typeof error === \"object\" && \"code\" in error\r\n        ? String((error as { code?: unknown }).code)\r\n        : \"\";\r\n    if (code === \"EPIPE\" || message.includes(\"EPIPE\")) {\r\n      return;\r\n    }\r\n    throw error;\r\n  };\r\n\r\n  process.stdout?.on(\"error\", ignorePipeError);\r\n  process.stderr?.on(\"error\", ignorePipeError);\r\n\r\n  if (isDev) {\r\n    win.webContents.on(\"console-message\", (_event, level, message, line, sourceId) => {\r\n      if (win.webContents.isDestroyed()) return;\r\n      safeLog(\"[renderer]\", level, message, sourceId, line);\r\n    });\r\n  }\r\n\r\n  const loadRenderer = async () => {\r\n    if (rendererUrl) {\r\n      console.log(\"[dev] rendererUrl =\", rendererUrl);\r\n      const ok = await canReach(rendererUrl);\r\n      if (ok) {\r\n        console.log(\"[dev] loadURL =\", rendererUrl);\r\n        void win.loadURL(rendererUrl);\r\n        return;\r\n      }\r\n      console.error(\"[dev] vite not reachable\", rendererUrl);\r\n    }\r\n    if (isDev) {\r\n      const fallbackUrl = \"http://localhost:5173/\";\r\n      const ok = await canReach(fallbackUrl);\r\n      if (ok) {\r\n        console.log(\"[dev] loadURL =\", fallbackUrl);\r\n        void win.loadURL(fallbackUrl);\r\n        return;\r\n      }\r\n      const distIndex = path.join(__dirname, \"../dist/index.html\");\r\n      if (fsSync.existsSync(distIndex)) {\r\n        console.log(\"[dev] loadFile =\", distIndex);\r\n        void win.loadFile(distIndex);\r\n        return;\r\n      }\r\n      const html = `<!doctype html><html><head><meta charset=\"utf-8\" /><title>Dev Server Unavailable</title></head><body style=\"font-family:sans-serif;padding:16px;\"><h2>Dev server not reachable</h2><p>Start Vite on http://localhost:5173 and reload.</p></body></html>`;\r\n      console.log(\"[dev] loadURL = dev fallback page\");\r\n      void win.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(html)}`);\r\n      return;\r\n    }\r\n    void win.loadFile(path.join(__dirname, \"../dist/index.html\"));\r\n  };\r\n  void loadRenderer();\r\n  if (process.env.OPEN_DEV_TOOLS) {\r\n    win.webContents.openDevTools({ mode: \"detach\" });\r\n  }\r\n  mainWindow = win;\r\n  win.on(\"closed\", () => {\r\n    mainWindow = null;\r\n  });\r\n  return win;\r\n};\r\n\r\nconst gotTheLock = app.requestSingleInstanceLock();\r\nif (!gotTheLock) {\r\n  app.quit();\r\n  process.exit(0);\r\n} else {\r\n  app.on(\"second-instance\", () => {\r\n    if (mainWindow && !mainWindow.isDestroyed()) {\r\n      if (mainWindow.isMinimized()) mainWindow.restore();\r\n      mainWindow.show();\r\n      mainWindow.focus();\r\n      return;\r\n    }\r\n    createMainWindow();\r\n  });\r\n}\r\n\r\nif (process.env.VITE_DEV_SERVER_URL) {\r\n  const temp = app.getPath(\"temp\");\r\n  const devRoot = path.join(temp, \"nkc-electron-dev\");\r\n  const devUserData = path.join(devRoot, \"userData\");\r\n  const devCache = path.join(devRoot, \"cache\");\r\n  const devSession = path.join(devRoot, \"sessionData\");\r\n  const devTemp = path.join(devRoot, \"temp\");\r\n  fsSync.mkdirSync(devUserData, { recursive: true });\r\n  fsSync.mkdirSync(devCache, { recursive: true });\r\n  fsSync.mkdirSync(devSession, { recursive: true });\r\n  fsSync.mkdirSync(devTemp, { recursive: true });\r\n  app.setPath(\"userData\", devUserData);\r\n  app.setPath(\"sessionData\", devSession);\r\n  app.setPath(\"temp\", devTemp);\r\n  console.log(\"[dev] userData =\", app.getPath(\"userData\"), \"temp =\", app.getPath(\"temp\"));\r\n}\r\n\r\napp.whenReady().then(() => {\r\n  if (isDev) {\r\n    console.log(\"[main] VITE_DEV_SERVER_URL =\", process.env.VITE_DEV_SERVER_URL ?? \"\");\r\n  }\r\n  registerProxyIpc();\r\n  registerOnionIpc();\r\n  createMainWindow();\r\n  app.on(\"activate\", () => {\r\n    if (BrowserWindow.getAllWindows().length === 0) {\r\n      createMainWindow();\r\n    }\r\n  });\r\n});\r\n\r\napp.on(\"before-quit\", () => console.log(\"[main] before-quit\"));\r\napp.on(\"will-quit\", () => console.log(\"[main] will-quit\"));\r\napp.on(\"quit\", (_event, code) => console.log(\"[main] quit\", code));\r\n\r\napp.on(\"window-all-closed\", () => {\r\n  if (process.platform !== \"darwin\") {\r\n    app.quit();\r\n  }\r\n});\r\n"],"names":["URL","pipeline","fs","execFile","resolveDownload","rollback","spawn","session","sha256","app","net","ipcMain","BrowserWindow"],"mappings":"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"}